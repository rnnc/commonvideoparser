"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _moment=_interopRequireDefault(require("moment")),_bluebird=_interopRequireDefault(require("bluebird")),_vimeo=require("vimeo"),_config=require("./config"),_helper=require("./helper"),_constants=require("./constants");exports.__esModule=!0,exports.default=void 0;const errBuild=(a,b)=>(0,_helper.errorBuild)("Vimeo",a,b),vimeoApi=()=>{const{CLIENT_ID:a,CLIENT_SECRET:b,ACCESS_TOKEN:c}=(0,_config.getVimeoApiConfig)();return new _vimeo.Vimeo(a,b,c)};function parseVideoId(a){const b=_constants.VIMEO_REGEX.exec(a);if(b)return b[1];throw"Failed to parse link"}function parseVideoInfo(a){const{user:b,name:c,uri:d,duration:e,width:f,height:g,created_time:h,release_time:i}=a;return{name:c,duration:_moment.default.duration(e,"s").toISOString(),link:a.link,description:a.description,user:b.name,created_time:h,release_time:i,dimensions:`${f} x ${g}`,thumbnail:a.pictures.sizes.pop().link.replace("?r=pad","")}}function videoRequest(a){return new _bluebird.default((b,c)=>{vimeoApi().request({path:`videos/${parseVideoId(a)}`},(a,d)=>{a?c(JSON.parse(a.message).error):b(parseVideoInfo(d))})})}function multiVideoRequest(a){const b=a.map(a=>new _bluebird.default(async(b,c)=>{videoRequest(a).then(a=>b(a)).catch(b=>c({error:b,link:a}))}));return _bluebird.default.all(b.map(a=>a.reflect())).then(a=>[a.filter(a=>a.isFulfilled()).map(a=>a.value()),a.filter(a=>a.isRejected()).map(a=>a.reason())]).then(a=>[].concat.apply([],a))}var _default={setVimeoApiConfig:_config.setVimeoApiConfig,async videoData(...a){if(!(0,_config.getVimeoApiConfig)())throw errBuild("videoData",`Vimeo Api Config not set, use 'setVimeoApiConfig'`);if(0==a.length||(0,_helper.arrayCheck)(a[0])&&0==a[0].length)throw errBuild("videoData",`Empty`);try{if((0,_helper.stringCheck)(a[0]))return 1==a.length?videoRequest(a[0]):multiVideoRequest(a);if((0,_helper.arrayCheck)(a[0])&&(0,_helper.stringCheck)(a[0][0]))return 1==a[0].length?videoRequest(a[0][0]):multiVideoRequest(a[0])}catch(a){throw errBuild("videoData",a)}throw errBuild("videoData",`Invalid param type, String(s) expected`)}};exports.default=_default;