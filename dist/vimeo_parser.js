"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _promise=_interopRequireDefault(require("@babel/runtime/core-js/promise")),_moment=_interopRequireDefault(require("moment")),_vimeo=require("vimeo"),_config=require("./config"),_helper=require("./helper");exports.__esModule=!0,exports.default=void 0;const errBuild=(a,b)=>(0,_helper.errorBuild)("Vimeo",a,b),url_regex=(0,_config.parsingRegex)("vimeo"),API_CHECK=a=>{if(!(0,_config.getVimeoApiConfig)())throw errBuild(a,`Vimeo Api Config not set, use 'setVimeoApiConfig'`);return!0},vimeoApi=()=>{const{CLIENT_ID:a,CLIENT_SECRET:b,ACCESS_TOKEN:c}=(0,_config.getVimeoApiConfig)();return new _vimeo.Vimeo(a,b,c)};function parseVideoId(a){const b=url_regex.exec(a);if(b)return b[1];throw errBuild(this.constructor.name,"Failed to parse link")}function videoRequest(a){return new _promise.default((b,c)=>{vimeoApi().request({path:`videos/${parseVideoId(a)}`},(a,d)=>{a?c(JSON.parse(a.message).error):b(parseVideoInfo(d))})})}function parseVideoInfo(a){const{user:b,name:c,uri:d,duration:e,width:f,height:g,created_time:h,release_time:i}=a;return{name:c,duration:_moment.default.duration(e,"s").toISOString(),link:a.link,description:a.description,user:b.name,created_time:h,release_time:i,dimensions:`${f} x ${g}`,thumbnail:a.pictures.sizes.pop().link.replace("?r=pad","")}}var _default={setVimeoApiConfig:_config.setVimeoApiConfig,async videoData(a){if(API_CHECK("videoData"),Array.isArray(a)){let b=[];for(const c of a)try{b.push((await videoRequest(c)))}catch(a){b.push({error:a,video:c})}return b}if((0,_helper.stringCheck)(a))return videoRequest(a);throw errBuild("videoData",`Invalid param type, String or String[] expected; got "${typeof a}" instead`)}};exports.default=_default;